<!DOCTYPE html>
<html>
  <head>
    <title>ACT Crimes</title>
    <style type="text/css">
    </style>

  </head>
  <body>
    <h1>ACT Crimes</h1>
    <div id="drawing"></div>

    <!-- All the scripts needed to get the drawingualisation working -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.5/svg.min.js"></script>
  	<script type="text/javascript" src="data/crime.json"></script>
    <script type="text/javascript" src="../transport/data/transport.json"></script>

    <script type="text/javascript">
      var draw = SVG("drawing").size(1000, 1000);

      const numCategories = 11;
      var separation = new Array(numCategories);
      for (var i = 0; i < separation.length; i++) {
        separation[i] = 1;
      }
      //var separation = [10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];

      console.log(separation);

      const maxCircleSize = 840;
      const gridCirclesCt = 10;
      const circleIncrements = 84;
      const margin = 100;
      const gridCenter = (maxCircleSize / 2) + margin;

      var corners = [
        {x: 420 + margin, y: 0 + margin},
        {x: 647.0691433313509 + margin, y: 66.67351621090383 + margin},
        {x: 802.0454380488977 + margin, y: 245.52569453920776 + margin},
        {x: 835.7250055899917 + margin, y: 479.77223207477977 + margin},
        {x: 737.4148212287885 + margin, y: 695.0415082570197 + margin},
        {x: 538.3276738734005 + margin, y: 822.9870489180888 + margin},
        {x: 301.67232612659967 + margin, y: 822.9870489180888 + margin},
        {x: 102.58517877121153 + margin, y: 695.0415082570197 + margin},
        {x: 4.274994410008276 + margin, y: 479.77223207477977 + margin},
        {x: 37.954561951102335 + margin, y: 245.52569453920742 + margin},
        {x: 192.9308566686489 + margin, y: 66.67351621090377 + margin}
      ];

      // Pie chart
      // Based on tutorial https://danielpataki.com/svg-pie-chart-javascript/

      var sectors = [];
      var colors = 'none';

      var l = (maxCircleSize / 2);
      var a = 0; // Angle
      var aRad = 0; // Angle in Rad
      var z = 0; // Size z
      var x = 0; // Side x
      var y = 0; // Side y
      var X = 0; // SVG X coordinate
      var Y = 0; // SVG Y coordinate
      var R = 0; // Rotation

      separation.map(function(item, key) {

        let percentage = item / numCategories;
        a = 360 * percentage;
        aCalc = (a > 180) ? 360 - a : a;
        aRad = aCalc * Math.PI / 180;
        z = Math.sqrt(2 * l * l - (2 * l * l * Math.cos(aRad)));
        if (aCalc <= 90) {
          x = l * Math.sin(aRad);
        } else {
          x = l * Math.sin((180 - aCalc) * Math.PI / 180 );
        }

        y = Math.sqrt(z * z - x * x);
        Y = y;

        if (a <= 180) {
          X = l + x;
          arcSweep = 0;
        } else {
          X = l - x;
          arcSweep = 1;
        }

        sectors.push({
          percentage: percentage,
          color: colors,
          arcSweep: arcSweep,
          L: l,
          X: X,
          Y: Y,
          R: R
        });
        R = R + a;

      })

      console.log(sectors)

      sectors.map(function(sector) {
          var path = draw.path('M' + (sector.L + margin) + ',' + (sector.L + margin) + ' L' + (sector.L + margin) + ',' + margin + 'A' + sector.L + ',' + sector.L + ' 1 0,1 ' + (sector.X + margin) + ', ' + (sector.Y + margin) + ' z');
          path.fill(sector.color);
          path.stroke({color: 'black', width: 0.2});
          path.rotate(sector.R, sector.L + margin, sector.L + margin);

      });

      for (var i = 0; i < gridCirclesCt; i++) {
        var gridLines = draw.circle(circleIncrements * i);
        gridLines.center(maxCircleSize * 0.5 + margin, maxCircleSize * 0.5 + margin);
        gridLines.fill('none');

        gridLines.stroke({color: 'black', width: 0.2});
      }

      function pointCoordinates(x1, y1, x2, y2, value, maxValue) {
        var xCoord = x1 + ((x2 - x1) * value / maxValue);
        var yCoord = y1 + ((y2 - y1) * value / maxValue);
        return {x: xCoord, y: yCoord};
      }

      /*corners.map(function(corner) {
        var circle = draw.circle(5);
        circle.center(corner.x, corner.y);
      })*/

      const maxValue = 320;

      var circleCenter = pointCoordinates(gridCenter, gridCenter, corners[0].x, corners[0].y, crimeData[2].assault, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);//.rotate(sectors[0].R, gridCenter, gridCenter);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[1].x, corners[1].y, crimeData[2].sexualAssault, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[2].x, corners[2].y, crimeData[2].offencesPerson, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[3].x, corners[3].y, crimeData[2].burglary, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[4].x, corners[4].y, crimeData[2].robbery, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[5].x, corners[5].y, crimeData[2].motorVehicleTheft, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[6].x, corners[6].y, crimeData[2].propertyDmg, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[7].x, corners[7].y, crimeData[2].offencesOther, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[8].x, corners[8].y, crimeData[2].trafficInfringement, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[9].x, corners[9].y, crimeData[2].theftGeneral, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      circleCenter = pointCoordinates(gridCenter, gridCenter, corners[10].x, corners[10].y, crimeData[2].roadCollision, maxValue);
      draw.circle(5).center(circleCenter.x, circleCenter.y);
      /*circleCenter = pointCoordinates(gridCenter, gridCenter, corners[1].x, corners[1].y, crimeData[0].assault, 350);
      draw.circle(5).center(circleCenter.x, circleCenter.y).rotate(sectors[0].R, gridCenter, gridCenter);*/


    </script>
  </body>
</html>
