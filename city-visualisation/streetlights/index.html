<!DOCTYPE html>
<html>
  <head>
    <title>Street Lights in ACT</title>
    <style type="text/css">
      .suburbLabels {
        color: white;
      }

      body {
        background-color: #0e2549;
      }

      .streetlights {
        color: white;
      }
    </style>

  </head>
  <body>
    <h1>Street Lights in ACT Suburbs</h1>
    <div id="drawing"></div>

    <!-- All the scripts needed to get the drawingualisation working -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.5/svg.min.js"></script>
  	<script src="https://d3js.org/d3-array.v1.min.js"></script>
  	<script src="https://d3js.org/d3-geo.v1.min.js"></script>
  	<script type="text/javascript" src="data/suburbs.geojson.json"></script>
    <script type="text/javascript" src="data/lights_geometry.geojson.json"></script>
  	<script type="text/javascript" src="data/commute.json"></script>

    <script type="text/javascript">
      var drawing = SVG("drawing").size(1500, 1050);

      var projection = d3.geoMercator()
                          .scale(1)
                          .translate([400, 600]);

      //filter the geojson to include only those suburbs in the bike data list
      geojson.features = geojson.features.filter(g => lightsGeojson.features.some(l => l.properties.suburb == g.properties.ACT_LOCA_2));

      projection.fitExtent([[20,20],[1000,1000]], geojson);

      var mapPath = d3.geoPath(projection);

      geojson.features.forEach(f => {
        dataValue = commuteData[f.properties.ACT_LOCA_2];
        var sg = drawing.group();
        var outline = sg.path(mapPath(f)).id(f.properties.ACT_LOCA_2);
        outline.fill('#0e2549');
        //outline.stroke({color: 'black'});


        // // store the label text on the group
        // sg.labelString = f.properties.ACT_LOCA_2 + " - " + Math.floor(dataValue*100)+'%';
        // // and the geo path data
        // sg.geoPath = f;
        //
        sg.on('mouseenter', function(){
          //label = drawing.text(this.labelString).move(mapPath.centroid(this.geoPath)[0],mapPath.centroid(this.geoPath)[1]);
        })

        sg.on('mouseleave', function(){
          //label.remove();
        })

      });

      lightsGeojson.features.forEach(f => {
        var sg = drawing.group();
        mapPath.pointRadius(1.5); // sets the radius of the street lights to 1
        var points = sg.path(mapPath(f)); // draw the points across the map

        mapPath.pointRadius(10); // make this (10 * f.properties.outreach)
        var outreach = sg.path(mapPath(f));
        outreach.opacity(0.1);


        // Compact fluorescent lights
        if (f.properties.lampType === "COMPACT FLUORESCENT") {
          points.fill('tomato');
          outreach.fill('tomato');
        }
        // Sodium lights
        else if (f.properties.lampType === "HIGH PRESSURE SODIUM"
                || f.properties.lampType === "SODIUM VAPOUR HIGH PRESSURE"
                || f.properties.lampType === "SODIUM VAPOUR HIGH PRESSURE TW"
                || f.properties.lampType === "SODIUM VAPOUR LOW PRESSURE") {
          points.fill('yellow');
          outreach.fill('yellow');
        }
        // LED lights
        else if (f.properties.lampType === "LIGHT EMITTING DIODE") {
          points.fill('white');
          outreach.fill('white');
        }
        // Metal halide lights
        else if (f.properties.lampType === "METAL HALIDE") {
          points.fill('green');
          outreach.fill('green');
        }
        // Mercury lights
        else if (f.properties.lampType === "MERCURY HIGH PRESURE FLUORESCE"
                || f.properties.lampType === "MERCURY HIGH PRESURE PHOSPHOR"
                || f.properties.lampType === "MERCURY LOW PRESURE FLUORESCEN"
                || f.properties.lampType === "MERCURY VAPOUR") {
          points.fill('cyan');
          outreach.fill('cyan');
        }
        // Unidentified lamp types or small categories
        else {
          points.fill('plum')
          outreach.fill('plum');
        }
        points.addClass('streetlights');

        sg.on('mouseenter', function(){
          console.log(d3.mouse(this));
          label = drawing.text("This is a text").move(mapPath.centroid(this.geoPath)[0],mapPath.centroid(this.geoPath)[1]);
        })

        sg.on('mouseleave', function(){
          label.remove();
        })
      })

      /*geojson.features.forEach(f => {
        dataValue = commuteData[f.properties.ACT_LOCA_2];
        var sg = drawing.group();
        var overlay = sg.path(mapPath(f)).id(f.properties.ACT_LOCA_2);
        overlay.fill('#0e2549');
        overlay.stroke({width: 3, color: 'white'});
        overlay.opacity(0);

        // store the label text and the path on the group
        sg.labelString = f.properties.ACT_LOCA_2;
        sg.geoPath = f;


        sg.on('mouseenter', function(){
          overlay.opacity(0.5);
          label = drawing.text(this.labelString)
                    .move(mapPath.centroid(this.geoPath)[0] - this.labelString.length * 5,mapPath.centroid(this.geoPath)[1])
                    .fill('white');
        })

        sg.on('mouseleave', function(){
          overlay.opacity(0);
          label.remove();
        })

      });*/

    </script>
  </body>
</html>
